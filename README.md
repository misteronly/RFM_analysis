# RFM_Анализ. Что это и с чем его едят?
![RFM_segments](https://github.com/misteronly/RFM_analysis/blob/main/rfm_picture.png)
### :grey_question: Кто наши лучшие клиенты?
### :grey_question: Кто из клиентов на грани потери?
### :grey_question: На какие сегменты можно разделить наших покупателей?
### :grey_question: На эти вопросы отвечает RFM анализ.
___
**RFM Анализ** - метод, позволяющий сегментировать клиентов, используя прошлое\
покупательское поведение и деление на сегменты\
Деление RFM проиходит на 3 группы:
1. Recency. Как давно клиент совершил покупку у нас - последняя дата покупки
2. Frequency. Как часто делают покупки - количество заказов
3. Monetory. Какую прибыль приносит покупатель - общая сумма

__Зачем нужен RFM Анализ?__

Благодаря разделению пользователей на различные группы,\
мы сможем более точечно подбирать рекламные предложения для каждого сегмента.\
Это позволит улучшить взаимодействие с клиентами, прибыль, стимулирование к\
повторным покупкам, а также вернуть спящих и давних клиентов.
```sql
/*Выбираем поля для расчетов: клиент, дата, сумма чека*/
with dataset as (
  select
  	card as clients,
  	date(datetime) as datetime,
  	summ  
  from
  	bonuscheques b 
),
/*Считаем разницу в днях между последним заказом и 01.01.2023
Количество заказов
Общую сумму для каждого клиента*/
group_dataset as (
  select
  	clients,
  	CAST('2023-01-01' as date) - MAX(datetime) as recency,
  	COUNT(summ) as frequency,
  	SUM(summ) as monetory
  from 
  	dataset
  group by clients
),
/*Считаем перцентили 33 и 66 для каждой группы*/
perc_rfm as (
  select 
    clients,
    recency,
    frequency,
    monetory,
    (select percentile_cont(0.33) within group(order by recency) as r_perc_33 from group_dataset),
    (select percentile_cont(0.66) within group(order by recency) as r_perc_66 from group_dataset),
    (select percentile_cont(0.33) within group(order by frequency) as f_perc_33 from group_dataset),
    (select percentile_cont(0.66) within group(order by frequency) as f_perc_66 from group_dataset),
    (select percentile_cont(0.33) within group(order by monetory) as m_perc_33 from group_dataset),
    (select (CAST(percentile_cont(0.66) within group(order by monetory) as INT)) as m_perc_66 from group_dataset)
  from
  	group_dataset
),
/*Производим деление клиентов на сегменты:
Чем меньше давность заказа(recency), тем выше оценка.Для частоты(frequency) и
суммы заказов(monetory) соотвественно: высокие значения соотвествуют значительным результатам*/
segment_rfm as (
  select 
  	clients,
  	recency,
  	case 
  		when recency < r_perc_33 then 3
  		when recency < r_perc_66 then 2 else 1
  	end as R,
  	frequency,
  	case 
  		when frequency <= f_perc_33 then 1
  		when frequency <= f_perc_66 then 2 else 3
  	end as F,
  	monetory,
  	case 
  		when monetory <= m_perc_33 then 1
  		when monetory <= m_perc_66 then 2 else 3
  	end as M 
  from
  	perc_rfm
),
/*Считаем кол-во клиентов для разных RFM - групп*/
union_rfm as (
  select
  	concat_ws('',r,f,m) as rfm_full,
  	COUNT(clients) as cnt_clients
  from
    segment_rfm
  group by concat_ws('',r,f,m)
),
/*Группируем клиентов на 8 основных сегментов*/
groups_rfm as (
  select 
  	cnt_clients,
  	rfm_full,
  	case 
  		when rfm_full in ('333') then 'VIP'
  		when rfm_full in ('332','331', '323') then 'Чемпионы'
		when rfm_full in ('322', '321') then 'Лояльные'
		when rfm_full in ('313', '312', '311') then 'Новички'
		when rfm_full in ('223', '222', '231', '232', '233') then 'Требуют внимания'		
		when rfm_full in ('213', '212', '221', '211') then 'Спящие'
		when rfm_full in ('113', '132', '131') then 'В зоне риска'
		when rfm_full in ('123', '122', '121') then 'На грани'
		when rfm_full in ('133', '112', '111') then 'Потерянные' 			
  	end as segment_rfm
  from
    union_rfm
),
total_clients as (
/*Считаем общую сумму по количеству клиентов для каждого из 8 сегментов */
	select
		segment_rfm,
		SUM(cnt_clients) as clients
	from
	  groups_rfm
	group by segment_rfm
	order by clients DESC
)
/*Считаем долю в процентах каждого сегмента*/
select 
	segment_rfm,
	ROUND(clients /  SUM(clients) over() * 100, 0) as percent_rfm
from
	total_clients
order by percent_rfm desc
```

### Выводы
:white_check_mark: Был произведен анализ покупательской активности, по следующим параметрам: давность, частота покупок, а так же сумма покупок.

:white_check_mark: Произведено разделение датасета на различные сегменты, в зависимости от покупательских особенностей.

:white_check_mark: На основе этих данных, подсчитанно: какое количество пользователей принадлежит каждому сегменту. И выработаны практические действия для активации каждого из 9 сегментов.

__В результате имеем:__
+ доминирующий сегмент - «**Потерянные**», они составляют 22%.
	+ Данный сегмент представляет собой покупателей, которые очень давно были в аптеке и купили всего один раз. Попробуем их реанимировать. 
 		+  Например: «Вы покупали у нас …. Товар. Сейчас на него действует скидка в 20%. Заходите к нам и становитесь здоровее. Акция действует 7 дней».
   		+  Данный сегмент покупателей «случайно» зашли за разовой покупкой, поэтому нет смысла тратить слишком много сил на их возвращение.	  
+ на 2 месте – «**Требуют внимания**», они составляют 20%
	+ Данный сегмент покупал относительно недавно и на средне-высокий чек. Нужно понять, почему эти люди перестали приходить: провести электронный опрос. Также необходимо отправить им ограниченные предложения на основе тех товаров, которые они уже покупали.
 		+ Например, «Внутри этого сообщения опрос, который займет всего 2 минуты и после прохождения вы получите промокод в подарок на последующие покупки»
+ на 3 месте – «**VIP**», они составляют 14%
	+ Это наши сливки, нужно показывать, что мы дорожим ими. Например, отправлять особые предложения, выдать лимитированные скидочные карты.
 		+  Например: «Мы рады, что вы с нами и поэтому приготовили в подарок лимитированную карту с любым из представленных дизайнов и статью от Стэнфордского университета: ‘Витамин С. Откуда его взять и почему он так важен для нашего здоровья’»
+ На 4 месте - «**Спящие**» они составляют 13%.
	+ Данный сегмент представляет собой покупателей, которые покупали относительно недавно и на средне-высокий чек. Нужно напомнить о нашей сети. Для этого необходимо запустить специальные предложения и скидки.
 		+  Например: «Для выгодных покупок не нужен повод! Дарим скидку 500р. на все товары при заказе от 1500р. Действует в течении пяти дней»
 + На 5 месте - «**Чемпионы**» они составляют 10%.
 	+ Данный сегмент представляет собой покупателей, которые совершают покупки часто и на солидную сумму. Они могут стать первыми пользователями новых продуктов. Они доказали свою более высокую готовность платить, поэтому вместо скидок лучше предложить более подходящие товары для выбора.
  		+  Например, «Недавно вы добавили эти товары в корзину, но так и не завершили покупку. Мы собрали эти товары в одном письме, чтобы вам было проще вернуться к выбору нужных товаров, пока они есть в наличии. Если возникли проблемы с оформлением заказа, напишите нам по адресу ….»
  + 6 место разделили два сегмента с одинаковыми показателями – это «**На грани**» и «**Лояльные**». Они составляют по 7%.
  	+ На грани» данный сегмент представляет покупателей, которые совершали покупки давно и на средне-низкий чек. Их необходимо «реанимировать». При обычных рассылках клиенту, можно улететь в СПАМ, так как есть причина почему человек перестал быть активным. Решение: можно напомнить клиенту об оставшихся у него бонусов.
   		+ Напримр: «Вас давно не было, и мы скучаем. Мы дарим вам 700 бонусов в подарок. Ваш баланс теперь 1000 бонусов. Подарок действует до 7 октября.»
   	+  «Лояльные» данный сегмент представляет покупателей, которые совершают частые покупки на крупные суммы. Можно предлагать им более дорогие товары и просить оставить отзыв.
    		+   Например: «Добрый день, мы заботимся о вашем здоровье и поэтому предлагаем импортные товары от известных компаний, которые подтвердили свое место быть в аптечке каждого человека!».
+ 7 место разделили два сегмента с одинаковыми показателями – это «**Новички**» и «**В зоне риска**». Они составляют по 3%.
	+  «Новички» данный сегмент представляет покупателей, которые совершали разовую покупку совсем недавно. Им нужно показать почему на наш бренд стоит обратить внимание.
 		+   Например: «Сейчас мы проводим мероприятие с призовыми местами. Успейте поучаствовать до 10 октября. Общая сумма покупок за последний месяц должны превышать 3000р. 1 место – купон на 3500р. 2 место – купон на 2000р. 3 место- купон на 1000р.».
 	+   «В зоне риска» данный сегмент представляет покупателей, которые совершили последнюю покупки давно, но ранее закупались часто и на относительно высокую сумму. Им нужно напомнить о нас и отправить рассылки с выгодными предложениями.
  		+   Например: «Обратили внимание, что вы давно к нам не заходили. И это хорошо, значит вы и ваши близкие здоровы! Просто напомним, что впереди осень и мы хотим сделать вам взаимовыгодное предложение. На товары во вкладке «Осень» повысили кэшбэк до 25%! Будьте здоровы!»



